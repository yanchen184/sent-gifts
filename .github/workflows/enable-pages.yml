name: Enable GitHub Pages

on:
  workflow_dispatch:

permissions:
  contents: write
  pages: write
  id-token: write

jobs:
  enable-pages:
    runs-on: ubuntu-latest
    steps:
    - name: Enable GitHub Pages
      uses: actions/github-script@v7
      with:
        script: |
          try {
            // Try to create Pages site
            const response = await github.rest.repos.createPagesSite({
              owner: context.repo.owner,
              repo: context.repo.repo,
              source: {
                branch: 'gh-pages',
                path: '/'
              }
            });
            console.log('âœ… GitHub Pages enabled successfully!');
            console.log('ğŸŒ Site URL:', response.data.html_url);
          } catch (error) {
            if (error.status === 409) {
              console.log('âœ… GitHub Pages already enabled');
              // Try to get existing Pages info
              try {
                const pages = await github.rest.repos.getPages({
                  owner: context.repo.owner,
                  repo: context.repo.repo,
                });
                console.log('ğŸŒ Site URL:', pages.data.html_url);
              } catch (getError) {
                console.log('Could not get Pages info:', getError.message);
              }
            } else {
              console.log('âŒ Error enabling Pages:', error.message);
              console.log('Status:', error.status);
            }
          }
